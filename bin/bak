#!/bin/bash

for filepath in "$@"; do
	# remove any trailing slashes from directory names
	filepath="${filepath/%\//}"
	filepath_bak="$filepath.bak"
	if [[ -f "$filepath_bak" ]]; then
	 	i=1
		filepath_bak_i="$filepath_bak.$i"
		while [[ -f "$filepath_bak_i" ]]; do
			((i++))
			filepath_bak_i="$filepath_bak.$i"
		done
		filepath_bak="$filepath_bak_i"
	fi
	[ -d "$filepath" ] && DIR_SYMBOL="/" || DIR_SYMBOL=""
	echo -n "$filepath${DIR_SYMBOL} => "
	cp -r --preserve=all "$filepath$DIR_SYMBOL" "$filepath_bak$DIR_SYMBOL"
	echo "$filepath_bak${DIR_SYMBOL}"
done