#!/usr/bin/env python3

import os
import re
import sys
import optparse

parser = optparse.OptionParser()
parser.add_option("-o", "--offset", dest="offset", type="int", default=0,
					help="Start reading file at byte position.")
parser.add_option("-b", "--bytes", dest="bytes", type="int", default=500,
					help="Number of bytes to read into file.")
parser.add_option("-m", "--max", "--match-size-max", dest="matchmax", type="int", default=0,
					help="Specify the maximum number of bytes required for a match.")
parser.add_option("-n", "--min", "--match-size-min", dest="matchmin", type="int", default=0,
					help="Specify the minimum number of bytes matched required for a match.")
parser.add_option("-c", "--color", dest="color", action="store_true", default=False,
					help="Colorize matched value when -s flag is used.")
parser.add_option("-s", "--snippet", dest="snippet", type="int", default=0,
					help="Show bytes surrounding matched values.")
parser.add_option("--hex", dest="hex", action="store_true", default=True,
					help="Display matched value in hex format.")
parser.add_option("-d", "--decode", dest="hex", action="store_false", default=True,
					help="Display matched value in decoded python bytes format.")
(options, optionargs) = parser.parse_args()

sigs = {' 01 10': {'Novell LANalyzer capture file'},
 ' 2A 2A 2A 20 20 49 6E 73': {'Symantec Wise Installer log'},
 '00 00 00 0C 6A 50 20 20': {'JPEG2000 image files'},
 '00 00 00 14 66 74 79 70': {'3GPP multimedia files'},
 '00 00 00 18 66 74 79 70': {'MPEG-4 video files'},
 '00 00 00 20 66 74 79 70': {'3GPP2 multimedia files'},
 '00 00 00 20 66 74 79 70 4D 34 41': {'Apple audio and video files'},
 '00 00 01 00': {'Windows icon|printer spool file'},
 '00 00 01 B3': {'MPEG video file'},
 '00 00 01 BA': {'DVD video file'},
 '00 00 02 00': {'Windows cursor', 'QuattroPro spreadsheet'},
 '00 00 02 00 06 04 06 00': {'Lotus 1-2-3 (v1)'},
 '00 00 1A 00 00 10 04 00': {'Lotus 1-2-3 (v3)'},
 '00 00 1A 00 02 10 04 00': {'Lotus 1-2-3 (v4|v5)'},
 '00 00 1A 00 05 10 04': {'Lotus 1-2-3 (v9)'},
 '00 00 49 49 58 50 52': {'Quark Express (Intel)'},
 '00 00 4D 4D 58 50 52': {'Quark Express (Motorola)'},
 '00 00 FF FF FF FF': {'Windows Help file_1'},
 '00 01 00 00 4D 53 49 53 41 4D 20 44 61 74 61 62 61 73 65': {'Microsoft Money file'},
 '00 01 00 00 53 74 61 6E 64 61 72 64 20 41 43 45 20 44 42': {'Microsoft Access 2007'},
 '00 01 00 00 53 74 61 6E 64 61 72 64 20 4A 65 74 20 44 42': {'Microsoft Access'},
 '00 01 42 41': {'Palm Address Book Archive'},
 '00 01 42 44': {'Palm DateBook Archive'},
 '00 06 15 61 00 00 00 02 00 00 04 D2 00 00 10 00': {'Netscape Navigator (v4) database'},
 '00 11': {'FLIC animation'},
 '00 14 00 00 01 02': {'BIOS details in RAM'},
 '00 1E 84 90 00 00 00 00': {'Netscape Communicator (v4) mail folder'},
 '00 6E 1E F0': {'PowerPoint presentation subheader_1'},
 '01 0F 00 00': {'SQL Data Base'},
 '01 10': {'Novell LANalyzer capture file'},
 '01 DA 01 01 00 03': {'Silicon Graphics RGB Bitmap'},
 '01 FF 02 04 03 02': {'Micrografx vector graphic file'},
 '02 64 73 73': {'Digital Speech Standard file'},
 '03': {'dBASE III file', 'MapInfo Native Data Format'},
 '03 00 00 00': {'Quicken price history'},
 '03 00 00 00 41 50 50 52': {'Approach index file'},
 '04': {'dBASE IV file'},
 '04 00 00 00': {'INFO2 Windows recycle bin_1'},
 '05 00 00 00': {'INFO2 Windows recycle bin_2'},
 '07': {'Generic drawing programs'},
 '07 53 4B 46': {'SkinCrafter skin'},
 '07 64 74 32 64 64 74 64': {'DesignTools 2D Design file'},
 '08': {'dBASE IV or dBFast configuration file'},
 '09 08 10 00 00 06 05 00': {'Excel spreadsheet subheader_1'},
 '0A 02 01 01': {'ZSOFT Paintbrush file_1'},
 '0A 03 01 01': {'ZSOFT Paintbrush file_2'},
 '0A 05 01 01': {'ZSOFT Paintbrush file_3'},
 '0C ED': {'Monochrome Picture TIFF bitmap'},
 '0D 44 4F 43': {'DeskMate Document'},
 '0E 4E 65 72 6F 49 53 4F': {'Nero CD compilation'},
 '0E 57 4B 53': {'DeskMate Worksheet'},
 '0F 00 E8 03': {'PowerPoint presentation subheader_2'},
 '11 00 00 00 53 43 43 41': {'Windows prefetch file'},
 '1A 00 00': {'Lotus Notes database template'},
 '1A 00 00 04 00 00': {'Lotus Notes database'},
 '1A 02': {'LH archive (old vers.|type 1)'},
 '1A 03': {'LH archive (old vers.|type 2)'},
 '1A 04': {'LH archive (old vers.|type 3)'},
 '1A 08': {'LH archive (old vers.|type 4)'},
 '1A 09': {'LH archive (old vers.|type 5)'},
 '1A 0B': {'PAK Compressed archive file', 'Compressed archive file'},
 '1A 35 01 00': {'WinPharoah capture file'},
 '1A 45 DF A3 93 42 82 88': {'Matroska stream file'},
 '1A 52 54 53 20 43 4F 4D': {'Runtime Software disk image'},
 '1D 7D': {'WordStar Version 5.0|6.0 document'},
 '1F 8B 08': {'GZIP archive file'},
 '1F 9D 90': {'Compressed tape archive_1'},
 '1F A0': {'Compressed tape archive_2'},
 '21 12': {'AIN Compressed Archive'},
 '21 3C 61 72 63 68 3E 0A': {'Unix archiver (ar)|MS Program Library Common Object File Format (COFF)'},
 '23 20': {'Cerius2 file'},
 '23 20 44 69 73 6B 20 44': {'VMware 4 Virtual Disk description'},
 '23 20 4D 69 63 72 6F 73': {'MS Developer Studio project file'},
 '23 21 41 4D 52': {'Adaptive Multi-Rate ACELP Codec (GSM)'},
 '23 3F 52 41 44 49 41 4E': {'Radiance High Dynamic Range image file'},
 '24 46 4C 32 40 28 23 29': {'SPSS Data file'},
 '25 21 50 53 2D 41 64 6F': {'Encapsulated PostScript file'},
 '25 50 44 46': {'PDF file'},
 '28 54 68 69 73 20 66 69': {'BinHex 4 Compressed Archive'},
 '2A 2A 2A 20 20 49 6E 73': {'Symantec Wise Installer log'},
 '2D 6C 68': {'Compressed archive'},
 '2E 52 45 43': {'RealPlayer video file (V11+)'},
 '2E 52 4D 46': {'RealMedia streaming media'},
 '2E 52 4D 46 00 00 00 12': {'RealAudio file'},
 '2E 72 61 FD 00': {'RealAudio streaming media'},
 '2E 73 6E 64': {'NeXT|Sun Microsystems audio file'},
 '30': {'MS security catalog file'},
 '30 00 00 00 4C 66 4C 65': {'Windows Event Viewer file'},
 '30 26 B2 75 8E 66 CF 11': {'Windows Media Audio|Video File'},
 '30 31 4F 52 44 4E 41 4E': {'National Transfer Format Map'},
 '30 37 30 37 30': {'cpio archive'},
 '31 BE': {'MS Write file_1'},
 '32 BE': {'MS Write file_2'},
 '34 CD B2 A1': {'Tcpdump capture file'},
 '37 7A BC AF 27 1C': {'7-Zip compressed file'},
 '37 E4 53 96 C9 DB D6 07': {'zisofs compressed file'},
 '38 42 50 53': {'Photoshop image'},
 '3A 56 45 52 53 49 4F 4E': {'Surfplan kite project file'},
 '3C': {'BizTalk XML-Data Reduced Schema', 'Advanced Stream Redirector'},
 '3C 21 64 6F 63 74 79 70': {'AOL HTML mail'},
 '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D': {'Windows Visual Stylesheet'},
 '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3F 3E': {'User Interface Language'},
 '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3F 3E 0D 0A 3C 4D 4D 43 5F 43 6F 6E 73 6F 6C 65 46 69 6C 65 20 43 6F 6E 73 6F 6C 65 56 65 72': {'MMC Snap-in Control file'},
 '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3F 3E 0D 0A 3C 4D 4D 43 5F 43 6F 6E 73 6F 6C 65 46 69 6C 65 20 43 6F 6E 73 6F 6C 65 56 65 72 73 69 6F 6E 3D 22': {'MMC Snap-in Control file'},
 '3C 4D 61 6B 65 72 46 69': {'Adobe FrameMaker'},
 '3E 00 03 00 FE FF 09 00 06': {'Quatro Pro for Windows 7.0'},
 '3F 5F 03 00': {'Windows Help file_2'},
 '40 40 40 20 00 00 40 40 40 40': {'EndNote Library File'},
 '41 43 31 30': {'Generic AutoCAD drawing'},
 '41 43 53 44': {'AOL parameter|info files'},
 '41 43 76': {'Steganos virtual secure drive'},
 '41 4D 59 4F': {'Harvard Graphics symbol graphic'},
 '41 4F 4C': {'AOL config files'},
 '41 4F 4C 20 46 65 65 64': {'AOL and AIM buddy list'},
 '41 4F 4C 44 42': {'AOL user configuration', 'AOL address book'},
 '41 4F 4C 49 44 58': {'AOL client preferences|settings file'},
 '41 4F 4C 49 4E 44 45 58': {'AOL address book index'},
 '41 4F 4C 56 4D 31 30 30': {'AOL personal file cabinet'},
 '41 56 47 36 5F 49 6E 74': {'AVG6 Integrity database'},
 '41 72 43 01': {'FreeArc compressed file'},
 '42 45 47 49 4E 3A 56 43': {'vCard'},
 '42 4C 49 32 32 33 51': {'Speedtouch router firmware'},
 '42 4D': {'Bitmap image'},
 '42 4F 4F 4B 4D 4F 42 49': {'Palmpilot resource file'},
 '42 5A 68': {'bzip2 compressed archive'},
 '43 23 2B 44 A4 43 4D A5': {'RagTime document'},
 '43 42 46 49 4C 45': {'WordPerfect dictionary'},
 '43 44 30 30 31': {'ISO-9660 CD Disc Image'},
 '43 4D 58 31': {'Corel Binary metafile'},
 '43 4F 4D 2B': {'COM+ Catalog'},
 '43 4F 57 44': {'VMware 3 Virtual Disk'},
 '43 50 54 37 46 49 4C 45': {'Corel Photopaint file_1'},
 '43 50 54 46 49 4C 45': {'Corel Photopaint file_2'},
 '43 52 45 47': {'Win9x registry hive'},
 '43 52 55 53 48 20 76': {'Crush compressed archive'},
 '43 57 53': {'Shockwave Flash file'},
 '43 61 74 61 6C 6F 67 20': {'WhereIsIt Catalog'},
 '43 6C 69 65 6E 74 20 55': {'IE History file'},
 '44 42 46 48': {'Palm Zire photo database'},
 '44 4D 53 21': {'Amiga DiskMasher compressed archive'},
 '44 4F 53': {'Amiga disk file'},
 '44 56 44': {'DVR-Studio stream file', 'DVD info file'},
 '45 4C 49 54 45 20 43 6F': {'Elite Plus Commander game file'},
 '45 4E 54 52 59 56 43 44': {'VideoVCD|VCDImager file'},
 '45 50': {'MS Document Imaging file'},
 '45 52 46 53 53 41 56 45': {'EasyRecovery Saved State file'},
 '45 56 46 09 0D 0A FF 00': {'Expert Witness Compression Format'},
 '45 6C 66 46 69 6C 65 00': {'Windows Vista event log'},
 '45 86 00 00 06 00': {'QuickBooks backup'},
 '46 41 58 43 4F 56 45 52': {'MS Fax Cover Sheet'},
 '46 4C 56': {'Flash video file'},
 '46 4F 52 4D 00': {'Audio Interchange File'},
 '46 57 53': {'Shockwave Flash player'},
 '46 72 6F 6D': {'Generic e-mail_2'},
 '47 49 46 38': {'GIF file'},
 '47 50 41 54': {'GIMP pattern file'},
 '47 58 32': {'Show Partner graphics file'},
 '48 48 47 42 31': {'Harvard Graphics presentation file'},
 '48 69 50 21': {'Houdini image file. Three-dimensional modeling and animation'},
 '49 20 49': {'TIFF file_1'},
 '49 44 33': {'MP3 audio file'},
 '49 44 33 03 00 00 00': {'Sprint Music Store audio'},
 '49 49 1A 00 00 00 48 45': {'Canon RAW file'},
 '49 49 2A 00': {'TIFF file_2'},
 '49 53 63 28': {'Install Shield compressed file'},
 '49 54 4F 4C 49 54 4C 53': {'MS Reader eBook'},
 '49 54 53 46': {'MS Compiled HTML Help File'},
 '49 6E 6E 6F 20 53 65 74': {'Inno Setup Uninstall Log'},
 '4A 41 52 43 53 00': {'JARCS compressed archive'},
 '4A 47 03 0E': {'AOL ART file_1'},
 '4A 47 04 0E': {'AOL ART file_2'},
 '4B 44 4D': {'VMware 4 Virtual Disk'},
 '4B 47 42 5F 61 72 63 68': {'KGB archive'},
 '4B 49 00 00': {'Win9x printer spool file'},
 '4B 57 41 4A 88 F0 27 D1': {'KWAJ (compressed) file'},
 '4C 00 00 00 01 14 02 00': {'Windows shortcut file'},
 '4C 01': {'MS COFF relocatable object code'},
 '4C 4E 02 00': {'Windows help file_3'},
 '4C 56 46 09 0D 0A FF 00': {'Logical File Evidence Format'},
 '4D 2D 57 20 50 6F 63 6B': {'Merriam-Webster Pocket Dictionary'},
 '4D 41 52 31 00': {'Mozilla archive'},
 '4D 41 52 43': {'Microsoft|MSN MARC archive'},
 '4D 41 72 30 00': {'MAr compressed archive'},
 '4D 44 4D 50 93 A7': {'Windows dump file'},
 '4D 49 4C 45 53': {'Milestones project management file'},
 '4D 4C 53 57': {'Skype localization data file'},
 '4D 4D 00 2A': {'TIFF file_3'},
 '4D 4D 00 2B': {'TIFF file_4'},
 '4D 4D 4D 44 00 00': {'Yamaha Synthetic music Mobile Application Format'},
 '4D 52 56 4E': {'VMware BIOS state file'},
 '4D 53 43 46': {'MS Access Snapshot Viewer file',
                 'Microsoft cabinet file',
                 'Powerpoint Packaged Presentation'},
 '4D 53 46 54 02 00 01 00': {'OLE|SPSS|Visual C++ library file'},
 '4D 53 5F 56 4F 49 43 45': {'Sony Compressed Voice File'},
 '4D 54 68 64': {'MIDI sound file'},
 '4D 56': {'CD Stomper Pro label file'},
 '4D 56 32 31 34': {'Milestones project management file_1'},
 '4D 56 32 43': {'Milestones project management file_2'},
 '4D 5A': {'ActiveX|OLE Custom Control',
           'Control panel application',
           'Font file',
           'Library cache file',
           'MS audio compression manager driver',
           'OLE object library',
           'Screen saver',
           'VisualBASIC application',
           'Windows virtual device drivers',
           'Windows|DOS executable file'},
 '4D 5A 90 00 03 00 00 00': {'Acrobat plug-in',
                             'Audition graphic filter',
                             'DirectShow filter'},
 '4D 5A 90 00 03 00 00 00 04 00 00 00 FF FF': {'ZoneAlam data file'},
 '4D 69 63 72 6F 73 6F 66 74 20 43 2F 43 2B 2B 20': {'MS C++ debugging symbols file'},
 '4D 69 63 72 6F 73 6F 66 74 20 56 69 73 75 61 6C': {'Visual Studio .NET file'},
 '4D 69 63 72 6F 73 6F 66 74 20 57 69 6E 64 6F 77 73 20 4D 65 64 69 61 20 50 6C 61 79 65 72 20 2D 2D 20': {'Windows Media Player playlist'},
 '4E 41 56 54 52 41 46 46': {'TomTom traffic data'},
 '4E 42 2A 00': {'MS Windows journal'},
 '4E 45 53 4D 1A 01': {'NES Sound file'},
 '4E 49 54 46 30': {'National Imagery Transmission Format file'},
 '4E 61 6D 65 3A 20': {'Agent newsreader character map'},
 '4F 50 4C 44 61 74 61 62': {'Psion Series 3 Database'},
 '4F 67 67 53 00 02 00 00': {'Ogg Vorbis Codec compressed file'},
 '4F 7B': {'Visio|DisplayWrite 4 text file'},
 '50 00 00 00 20 00 00 00': {'Quicken QuickFinder Information File'},
 '50 35 0A': {'Portable Graymap Graphic'},
 '50 41 43 4B': {'Quake archive file'},
 '50 41 47 45 44 55': {'Windows memory dump'},
 '50 41 58': {'PAX password protected bitmap'},
 '50 45 53 54': {'PestPatrol data|scan strings'},
 '50 47 50 64 4D 41 49 4E': {'PGP disk image'},
 '50 49 43 54 00 08': {'ChromaGraph Graphics Card Bitmap'},
 '50 4B 03 04': {'Customization files',
                 'Java archive_1',
                 'KWord document',
                 'MS Office Open XML Format Document',
                 'MacOS X Dashboard Widget',
                 'Mozilla Browser Archive',
                 'OpenDocument template',
                 'OpenOffice documents',
                 'PKZIP archive_1',
                 'StarOffice spreadsheet',
                 'Windows Media compressed skin file',
                 'XML paper specification file',
                 'eXact Packager Models'},
 '50 4B 03 04 14 00 01 00': {'ZLock Pro encrypted ZIP'},
 '50 4B 03 04 14 00 06 00': {'MS Office 2007 documents'},
 '50 4B 03 04 14 00 08 00': {'Java archive_2'},
 '50 4B 05 06': {'PKZIP archive_2'},
 '50 4B 07 08': {'PKZIP archive_3'},
 '50 4B 4C 49 54 45': {'PKLITE archive'},
 '50 4B 53 70 58': {'PKSFX self-extracting archive'},
 '50 4D 43 43': {'Windows Program Manager group file'},
 '50 4E 43 49 55 4E 44 4F': {'Norton Disk Doctor undo file'},
 '51 45 4C 20': {'QDL Quicken data'},
 '51 46 49': {'Qcow Disk Image'},
 '51 57 20 56 65 72 2E 20': {'ABD | QSD Quicken data file',
                             'Quicken data file'},
 '52 41 5A 41 54 44 42 31': {'Shareaza (P2P) thumbnail'},
 '52 45 47 45 44 49 54': {'WinNT Registry|Registry Undo files'},
 '52 45 56 4E 55 4D 3A 2C': {'Antenna data file'},
 '52 49 46 46': {'4X Movie video',
                 'Corel Presentation Exchange metadata',
                 'CorelDraw document',
                 'Micrografx Designer graphic',
                 'Resource Interchange File Format',
                 'Video CD MPEG movie',
                 'Windows animated cursor'},
 '52 54 53 53': {'WinNT Netmon capture file'},
 '52 61 72 21 1A 07 00': {'WinRAR compressed archive'},
 '52 65 74 75 72 6E 2D 50': {'Generic e-mail_1'},
 '53 43 48 6C': {'Underground Audio'},
 '53 43 4D 49': {'Img Software Bitmap'},
 '53 48 4F 57': {'Harvard Graphics presentation'},
 '53 49 45 54 52 4F 4E 49': {'Sietronics CPI XRD document'},
 '53 49 54 21 00': {'StuffIt archive'},
 '53 4D 41 52 54 44 52 57': {'SmartDraw Drawing file'},
 '53 51 4C 4F 43 4F 4E 56': {'DB2 conversion file'},
 '53 51 4C 69 74 65 20 66 6F 72 6D 61 74 20 33 00': {'SQLite database file'},
 '53 5A 20 88 F0 27 33 D1': {'QBASIC SZDD file'},
 '53 5A 44 44 88 F0 27 33': {'SZDD file format'},
 '53 74 75 66 66 49 74 20': {'StuffIt compressed archive'},
 '53 75 70 65 72 43 61 6C': {'SuperCalc worksheet'},
 '54 68 69 73 20 69 73 20': {'GNU Info Reader file'},
 '55 43 45 58': {'Unicode extensions'},
 '55 46 41 C6 D2 C1': {'UFA compressed archive'},
 '55 46 4F 4F 72 62 69 74': {'UFO Capture map file'},
 '56 43 50 43 48 30': {'Visual C PreCompiled header'},
 '56 45 52 53 49 4F 4E 20': {'Visual Basic User-defined Control file'},
 '56 65 72 73 69 6F 6E 20': {'MapInfo Interchange Format file'},
 '57 4D 4D 50': {'Walkman MP3 file'},
 '57 53 32 30 30 30': {'WordStar for Windows file'},
 '57 69 6E 5A 69 70': {'WinZip compressed archive'},
 '57 6F 72 64 50 72 6F': {'Lotus WordPro file'},
 '58 2D': {'Exchange e-mail'},
 '58 43 50 00': {'Packet sniffer files'},
 '58 50 43 4F 4D 0A 54 79': {'XPCOM libraries'},
 '58 54': {'MS Publisher'},
 '5A 4F 4F 20': {'ZOO compressed archive'},
 '5B 47 65 6E 65 72 61 6C': {'MS Exchange configuration file'},
 '5B 4D 53 56 43': {'Visual C++ Workbench Info File'},
 '5B 50 68 6F 6E 65 5D': {'Dial-up networking file'},
 '5B 56 45 52 5D': {'Lotus AMI Pro document_1'},
 '5B 57 69 6E 64 6F 77 73': {'Microsoft Code Page Translation file'},
 '5B 66 6C 74 73 69 6D 2E': {'Flight Simulator Aircraft Configuration'},
 '5B 76 65 72 5D': {'Lotus AMI Pro document_2'},
 '5F 27 A8 89': {'Jar archive'},
 '5F 43 41 53 45 5F': {'EnCase case file'},
 '60 EA': {'Compressed archive file', 'ARJ Compressed archive file'},
 '62 65 67 69 6E': {'UUencoded file'},
 '62 70 6C 69 73 74': {'Binary property list (plist)'},
 '63 6F 6E 65 63 74 69 78': {'Virtual PC HD image'},
 '63 75 73 68 00 00 00 02': {'Photoshop Custom Shape'},
 '64 00 00 00': {'Intel PROset|Wireless Profile'},
 '64 65 78 0A 30 30 39 00': {'Dalvik (Android) executable file'},
 '64 6E 73 2E': {'Audacity audio file'},
 '64 73 77 66 69 6C 65': {'MS Visual Studio workspace file'},
 '66 49 00 00': {'WinNT printer spool file'},
 '66 4C 61 43 00 00 00 22': {'Free Lossless Audio Codec file'},
 '66 72 65 65': {'QuickTime movie_2'},
 '67 49 00 00': {'Win2000|XP printer spool file'},
 '68 49 00 00': {'Win Server 2003 printer spool file'},
 '6C 33 33 6C': {'Skype user data file'},
 '6D 64 61 74': {'QuickTime movie_3'},
 '6D 6F 6F 76': {'QuickTime movie_1'},
 '6F 3C': {'SMS text (SIM)'},
 '70 6E 6F 74': {'QuickTime movie_5'},
 '72 65 67 66': {'WinNT registry file'},
 '72 69 66 66': {'Sonic Foundry Acid Music File'},
 '72 74 73 70 3A 2F 2F': {'RealMedia metafile'},
 '73 6B 69 70': {'QuickTime movie_6'},
 '73 6C 68 21': {'Allegro Generic Packfile (compressed)'},
 '73 6C 68 2E': {'Allegro Generic Packfile (uncompressed)'},
 '73 6D 5F': {'PalmOS SuperMemo'},
 '73 72 63 64 6F 63 69 64': {'CALS raster bitmap'},
 '73 7A 65 7A': {'PowerBASIC Debugger Symbols'},
 '74 42 4D 50 4B 6E 57 72': {'PathWay Map file'},
 '75 73 74 61 72': {'Tape Archive'},
 '76 32 30 30 33 2E 31 30': {'Qimage filter'},
 '77 69 64 65': {'QuickTime movie_4'},
 '78': {'MacOS X image file'},
 '7A 62 65 78': {'ZoomBrowser Image Index'},
 '7B 0D 0A 6F 20': {'Windows application log'},
 '7B 5C 70 77 69': {'MS WinMobile personal note'},
 '7B 5C 72 74 66 31': {'RTF file'},
 '7E 42 4B 00': {'Corel Paint Shop Pro image'},
 '7F 45 4C 46': {'ELF executable'},
 '80': {'Relocatable object code'},
 '80 00 00 20 03 12 04': {'Dreamcast audio'},
 '81 32 84 C1 85 05 D0 11': {'Outlook Express address book (Win95)'},
 '81 CD AB': {'WordPerfect text'},
 '89 50 4E 47 0D 0A 1A 0A': {'PNG image'},
 '8A 01 09 00 00 00 E1 08': {'MS Answer Wizard'},
 '91 33 48 46': {'Hamarsoft compressed archive'},
 '95 00': {'PGP secret keyring_1'},
 '95 01': {'PGP secret keyring_2'},
 '99': {'GPG public keyring'},
 '99 01': {'PGP public keyring'},
 '9C CB CB 8D 13 75 D2 11': {'Outlook address file'},
 'A0 46 1D F0': {'PowerPoint presentation subheader_3'},
 'A1 B2 C3 D4': {'tcpdump (libpcap) capture file'},
 'A1 B2 CD 34': {'Extended tcpdump (libpcap) capture file'},
 'A9 0D 00 00 00 00 00 00': {'Access Data FTK evidence'},
 'AC 9E BD 8F 00 00': {'Quicken data'},
 'AC ED': {'Java serialization data'},
 'AC ED 00 05 73 72 00 12': {'BGBlitz position database file'},
 'B0 4D 46 43': {'Win95 password file'},
 'B1 68 DE 3A': {'PCX bitmap'},
 'B4 6E 68 44': {'Acronis True Image'},
 'B5 A2 B0 B3 B3 B0 A5 B5': {'Windows calendar'},
 'BE 00 00 00 AB': {'MS Write file_3'},
 'C3 AB CD AB': {'MS Agent Character file'},
 'C5 D0 D3 C6': {'Adobe encapsulated PostScript'},
 'C8 00 79 00': {'Jeppesen FliteLog file'},
 'CA FE BA BE': {'Java bytecode'},
 'CD 20 AA AA 02 00 00 00': {'NAV quarantined virus file'},
 'CF 11 E0 A1 B1 1A E1 00': {'Perfect Office document'},
 'CF AD 12 FE': {'Outlook Express e-mail folder'},
 'D0 CF 11 E0 A1 B1 1A E1': {'Access project file',
                             'CaseWare Working Papers',
                             'Developer Studio File Options file',
                             'Lotus|IBM Approach 97 file',
                             'MS Publisher file',
                             'MSWorks database file',
                             'MSWorks text document',
                             'Microsoft Common Console Document',
                             'Microsoft Installer package',
                             'Microsoft Office document',
                             'Minitab data file',
                             'Revit Project file',
                             'SPSS output file',
                             'Visio file',
                             'Visual Studio Solution User Options file'},
 'D2 0A 00 00': {'WinPharoah filter file'},
 'D4 2A': {'AOL history|typed URL files'},
 'D4 C3 B2 A1': {'WinDump (winpcap) capture file'},
 'D7 CD C6 9A': {'Windows graphics metafile'},
 'DB A5 2D 00': {'Word 2.0 file'},
 'DC DC': {'Corel color palette'},
 'DC FE': {'eFax file'},
 'E3 10 00 01 00 00 00 00': {'Amiga icon'},
 'E3 82 85 96': {'Win98 password file'},
 'E4 52 5C 7B 8C D8 A7 4D': {'MS OneNote note'},
 'E8': {'Windows executable file_1'},
 'E9': {'Windows executable file_2'},
 'EB': {'Windows executable file_3'},
 'EB 3C 90 2A': {'GEM Raster file'},
 'EC A5 C1 00': {'Word document subheader'},
 'ED AB EE DB': {'RedHat Package Manager'},
 'EF BB BF': {'UTF8 file'},
 'FD FF FF FF': {'Thumbs.db subheader'},
 'FD FF FF FF 04': {'Visual Studio Solution subheader'},
 'FD FF FF FF 0E 00 00 00': {'PowerPoint presentation subheader_4'},
 'FD FF FF FF 10': {'Excel spreadsheet subheader_2'},
 'FD FF FF FF 1C 00 00 00': {'PowerPoint presentation subheader_5'},
 'FD FF FF FF 1F': {'Excel spreadsheet subheader_3'},
 'FD FF FF FF 20': {'Developer Studio subheader'},
 'FD FF FF FF 22': {'Excel spreadsheet subheader_4'},
 'FD FF FF FF 23': {'Excel spreadsheet subheader_5'},
 'FD FF FF FF 28': {'Excel spreadsheet subheader_6'},
 'FD FF FF FF 29': {'Excel spreadsheet subheader_7'},
 'FD FF FF FF 43 00 00 00': {'PowerPoint presentation subheader_6'},
 'FE EF': {'Symantex Ghost image file'},
 'FE FF': {'UTF-16|UCS-2 file'},
 'FF': {'Windows executable'},
 'FF 00 02 00 04 04 05 54': {'Works for Windows spreadsheet'},
 'FF 46 4F 4E 54': {'Windows international code page'},
 'FF 4B 45 59 42 20 20 20': {'Keyboard driver file'},
 'FF 57 50 43': {'WordPerfect text and graphics'},
 'FF D8 FF': {'JPEG|EXIF|SPIFF images'},
 'FF D8 FF E0': {'JFIF IMAGE FILE - jpeg',
                 'JPE IMAGE FILE - jpeg',
                 'JPEG IMAGE'},
 'FF D8 FF E1': {'Digital camera JPG using Exchangeable Image File Format (EXIF)'},
 'FF D8 FF E2': {'CANNON EOS JPEG FILE'},
 'FF D8 FF E3': {'SAMSUNG D500 JPEG FILE'},
 'FF D8 FF E8': {'Still Picture Interchange File Format (SPIFF)'},
 'FF FE': {'Windows Registry file'},
 'FF FE 00 00': {'UTF-32|UCS-4 file'},
 'FF FE 23 00 6C 00 69 00': {'MSinfo file'},
 'FF FF FF FF': {'DOS system driver'}}
hexes = ['0C ED', '63 6F 6E 65 63 74 69 78', '37 7A BC AF 27 1C', '00 00 01 00', '46 4F 52 4D 00', '1A 00 00', '00 00 00 20 66 74 79 70 4D 34 41', '4D 56 32 43', '52 49 46 46', 'A1 B2 CD 34', '2A 2A 2A 20 20 49 6E 73', 'E3 82 85 96', 'DB A5 2D 00', ' 2A 2A 2A 20 20 49 6E 73', '3F 5F 03 00', '5B 66 6C 74 73 69 6D 2E', '95 01', '95 00', '53 4D 41 52 54 44 52 57', '58 43 50 00', 'A1 B2 C3 D4', '3C 4D 61 6B 65 72 46 69', '4D 41 72 30 00', '46 72 6F 6D', '3C', 'FF 00 02 00 04 04 05 54', 'FF 4B 45 59 42 20 20 20', '50 4B 03 04 14 00 06 00', '00 00 00 18 66 74 79 70', '43 4F 57 44', '4F 50 4C 44 61 74 61 62', '7B 5C 70 77 69', '53 74 75 66 66 49 74 20', '49 54 4F 4C 49 54 4C 53', '43 50 54 37 46 49 4C 45', '5B 50 68 6F 6E 65 5D', '46 41 58 43 4F 56 45 52', '49 44 33 03 00 00 00', '23 20', '30', '09 08 10 00 00 06 05 00', '7B 0D 0A 6F 20', '41 43 53 44', 'D0 CF 11 E0 A1 B1 1A E1', 'FF', 'DC FE', '3E 00 03 00 FE FF 09 00 06', '50 4B 07 08', '1F 9D 90', '53 75 70 65 72 43 61 6C', 'FD FF FF FF 22', 'FD FF FF FF 23', 'FD FF FF FF 20', '1D 7D', '50 45 53 54', 'FD FF FF FF 28', 'FD FF FF FF 29', '45 6C 66 46 69 6C 65 00', '9C CB CB 8D 13 75 D2 11', '50 41 58', '75 73 74 61 72', '99', 'B0 4D 46 43', '49 53 63 28', '31 BE', '41 4F 4C', '41 72 43 01', 'C8 00 79 00', '46 4C 56', '4C 56 46 09 0D 0A FF 00', 'FE EF', '41 4F 4C 49 4E 44 45 58', '00 00 00 14 66 74 79 70', '89 50 4E 47 0D 0A 1A 0A', '4D 49 4C 45 53', '77 69 64 65', '44 4D 53 21', '4D 4C 53 57', '1F 8B 08', '4D 4D 4D 44 00 00', '00 00 4D 4D 58 50 52', '28 54 68 69 73 20 66 69', '4C 4E 02 00', '23 20 4D 69 63 72 6F 73', '55 43 45 58', 'CF AD 12 FE', '00 01 00 00 53 74 61 6E 64 61 72 64 20 41 43 45 20 44 42', '45 52 46 53 53 41 56 45', '00 06 15 61 00 00 00 02 00 00 04 D2 00 00 10 00', '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3F 3E 0D 0A 3C 4D 4D 43 5F 43 6F 6E 73 6F 6C 65 46 69 6C 65 20 43 6F 6E 73 6F 6C 65 56 65 72 73 69 6F 6E 3D 22', '73 6B 69 70', 'A0 46 1D F0', '4F 67 67 53 00 02 00 00', '62 65 67 69 6E', '32 BE', 'CF 11 E0 A1 B1 1A E1 00', 'B4 6E 68 44', '03 00 00 00 41 50 50 52', '7A 62 65 78', '00 00 49 49 58 50 52', 'EF BB BF', '11 00 00 00 53 43 43 41', '53 43 48 6C', '53 49 45 54 52 4F 4E 49', '23 20 44 69 73 6B 20 44', '30 26 B2 75 8E 66 CF 11', '4D 2D 57 20 50 6F 63 6B', '47 49 46 38', '00 1E 84 90 00 00 00 00', '45 4E 54 52 59 56 43 44', '04 00 00 00', '5B 57 69 6E 64 6F 77 73', '52 41 5A 41 54 44 42 31', '4D 53 46 54 02 00 01 00', '6D 64 61 74', 'A9 0D 00 00 00 00 00 00', '0A 05 01 01', '80', '38 42 50 53', '56 43 50 43 48 30', '4D 56 32 31 34', '44 56 44', '41 43 76', '00 01 00 00 4D 53 49 53 41 4D 20 44 61 74 61 62 61 73 65', '51 57 20 56 65 72 2E 20', 'E9', 'E8', '43 42 46 49 4C 45', 'B1 68 DE 3A', '7E 42 4B 00', '01 FF 02 04 03 02', 'EB', '4E 45 53 4D 1A 01', '58 50 43 4F 4D 0A 54 79', '66 4C 61 43 00 00 00 22', '01 10', '1F A0', '5F 43 41 53 45 5F', '0E 57 4B 53', 'CD 20 AA AA 02 00 00 00', '4D 53 43 46', '00 00 01 BA', '4B 57 41 4A 88 F0 27 D1', '50 41 43 4B', '48 69 50 21', '4E 42 2A 00', '73 7A 65 7A', '67 49 00 00', '8A 01 09 00 00 00 E1 08', 'C5 D0 D3 C6', '23 3F 52 41 44 49 41 4E', '50 49 43 54 00 08', '00 11', '4E 61 6D 65 3A 20', '5B 76 65 72 5D', '91 33 48 46', '1A 52 54 53 20 43 4F 4D', 'D2 0A 00 00', '66 72 65 65', '4D 54 68 64', '4D 5A', '0F 00 E8 03', '45 50', '41 43 31 30', '21 12', '00 00 FF FF FF FF', '30 31 4F 52 44 4E 41 4E', '76 32 30 30 33 2E 31 30', '2E 73 6E 64', '1A 0B', 'FD FF FF FF 0E 00 00 00', '4B 49 00 00', '68 49 00 00', '58 2D', '4D 52 56 4E', 'D7 CD C6 9A', 'ED AB EE DB', '42 4F 4F 4B 4D 4F 42 49', '45 86 00 00 06 00', 'EB 3C 90 2A', '4D 41 52 43', '4B 44 4D', '53 5A 20 88 F0 27 33 D1', '1A 03', '1A 02', '4E 49 54 46 30', '1A 04', '1A 09', '1A 08', '4C 00 00 00 01 14 02 00', '49 20 49', '30 00 00 00 4C 66 4C 65', '41 56 47 36 5F 49 6E 74', '0A 03 01 01', '44 42 46 48', '6C 33 33 6C', '4D 69 63 72 6F 73 6F 66 74 20 56 69 73 75 61 6C', '53 43 4D 49', '43 52 55 53 48 20 76', '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3F 3E 0D 0A 3C 4D 4D 43 5F 43 6F 6E 73 6F 6C 65 46 69 6C 65 20 43 6F 6E 73 6F 6C 65 56 65 72', '45 56 46 09 0D 0A FF 00', '4A 47 04 0E', '66 49 00 00', '50 47 50 64 4D 41 49 4E', '4D 41 52 31 00', '52 45 56 4E 55 4D 3A 2C', '4D 69 63 72 6F 73 6F 66 74 20 57 69 6E 64 6F 77 73 20 4D 65 64 69 61 20 50 6C 61 79 65 72 20 2D 2D 20', 'BE 00 00 00 AB', '4C 01', '03 00 00 00', '25 50 44 46', '49 49 1A 00 00 00 48 45', '4B 47 42 5F 61 72 63 68', 'FD FF FF FF', '41 4F 4C 44 42', 'FF 57 50 43', 'E3 10 00 01 00 00 00 00', '00 01 42 41', '00 01 42 44', '43 52 45 47', '00 00 02 00', '03', '99 01', '07', '04', '08', '5F 27 A8 89', '52 65 74 75 72 6E 2D 50', '64 73 77 66 69 6C 65', 'CA FE BA BE', '2D 6C 68', '4D 69 63 72 6F 73 6F 66 74 20 43 2F 43 2B 2B 20', '63 75 73 68 00 00 00 02', '57 4D 4D 50', '2E 72 61 FD 00', 'FF FE 00 00', '57 6F 72 64 50 72 6F', '51 45 4C 20', '53 51 4C 69 74 65 20 66 6F 72 6D 61 74 20 33 00', '4D 4D 00 2A', '4D 4D 00 2B', '43 6C 69 65 6E 74 20 55', '23 21 41 4D 52', '42 45 47 49 4E 3A 56 43', '1A 35 01 00', '44 4F 53', '51 46 49', '7B 5C 72 74 66 31', '73 72 63 64 6F 63 69 64', '01 0F 00 00', 'FD FF FF FF 1C 00 00 00', '43 44 30 30 31', 'AC 9E BD 8F 00 00', '58 54', '53 48 4F 57', '1A 00 00 04 00 00', '50 4B 03 04 14 00 01 00', '43 57 53', '25 21 50 53 2D 41 64 6F', '5B 4D 53 56 43', 'FF FE 23 00 6C 00 69 00', '37 E4 53 96 C9 DB D6 07', '5B 56 45 52 5D', '45 4C 49 54 45 20 43 6F', '62 70 6C 69 73 74', '72 65 67 66', '3A 56 45 52 53 49 4F 4E', '0D 44 4F 43', '50 4B 03 04 14 00 08 00', '4A 47 03 0E', '80 00 00 20 03 12 04', '2E 52 4D 46 00 00 00 12', '64 00 00 00', '42 5A 68', '4D 56', '49 6E 6E 6F 20 53 65 74', '07 64 74 32 64 64 74 64', 'FD FF FF FF 04', '70 6E 6F 74', '43 23 2B 44 A4 43 4D A5', 'DC DC', '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3F 3E', '2E 52 4D 46', '02 64 73 73', '50 4B 53 70 58', '05 00 00 00', '7F 45 4C 46', 'D4 2A', '00 01 00 00 53 74 61 6E 64 61 72 64 20 4A 65 74 20 44 42', 'D4 C3 B2 A1', '21 3C 61 72 63 68 3E 0A', 'FD FF FF FF 43 00 00 00', '07 53 4B 46', '0A 02 01 01', 'FF FE', '55 46 4F 4F 72 62 69 74', '4D 44 4D 50 93 A7', '41 4D 59 4F', '00 00 1A 00 05 10 04', 'FF 46 4F 4E 54', 'FF D8 FF', 'FF D8 FF E0', 'FF D8 FF E1', 'FF D8 FF E2', 'FF D8 FF E3', 'FF D8 FF E8', '00 00 02 00 06 04 06 00', 'AC ED', '00 14 00 00 01 02', '4E 41 56 54 52 41 46 46', '43 4F 4D 2B', '6F 3C', '52 45 47 45 44 49 54', '34 CD B2 A1', '49 54 53 46', '00 00 1A 00 00 10 04 00', '50 4B 03 04', '50 4E 43 49 55 4E 44 4F', '43 4D 58 31', 'B5 A2 B0 B3 B3 B0 A5 B5', 'AC ED 00 05 73 72 00 12', '50 00 00 00 20 00 00 00', '50 41 47 45 44 55', 'FF FF FF FF', 'EC A5 C1 00', 'C3 AB CD AB', '01 DA 01 01 00 03', '4A 41 52 43 53 00', '47 50 41 54', '52 61 72 21 1A 07 00', 'FE FF', '42 4D', '56 45 52 53 49 4F 4E 20', '52 54 53 53', '64 65 78 0A 30 30 39 00', '81 32 84 C1 85 05 D0 11', '43 61 74 61 6C 6F 67 20', '49 49 2A 00', '57 69 6E 5A 69 70', '50 4D 43 43', '73 6D 5F', '73 6C 68 2E', '48 48 47 42 31', '0E 4E 65 72 6F 49 53 4F', '53 5A 44 44 88 F0 27 33', '41 4F 4C 56 4D 31 30 30', '50 35 0A', '5A 4F 4F 20', '4D 53 5F 56 4F 49 43 45', '47 58 32', '53 51 4C 4F 43 4F 4E 56', '78', '00 00 1A 00 02 10 04 00', '72 74 73 70 3A 2F 2F', '1A 45 DF A3 93 42 82 88', '57 53 32 30 30 30', 'FD FF FF FF 10', '00 6E 1E F0', '81 CD AB', '50 4B 4C 49 54 45', '49 44 33', '00 00 01 B3', '73 6C 68 21', '56 65 72 73 69 6F 6E 20', '41 4F 4C 49 44 58', '40 40 40 20 00 00 40 40 40 40', '41 4F 4C 20 46 65 65 64', '4D 5A 90 00 03 00 00 00', '4D 5A 90 00 03 00 00 00 04 00 00 00 FF FF', '4F 7B', '60 EA', '74 42 4D 50 4B 6E 57 72', '64 6E 73 2E', 'FD FF FF FF 1F', '53 49 54 21 00', '24 46 4C 32 40 28 23 29', '43 50 54 46 49 4C 45', '00 00 00 0C 6A 50 20 20', '42 4C 49 32 32 33 51', 'E4 52 5C 7B 8C D8 A7 4D', '2E 52 45 43', '72 69 66 66', '00 00 00 20 66 74 79 70', '46 57 53', '54 68 69 73 20 69 73 20', '55 46 41 C6 D2 C1', '3C 21 64 6F 63 74 79 70', '3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D', '5B 47 65 6E 65 72 61 6C', ' 01 10', '30 37 30 37 30', '50 4B 05 06', '6D 6F 6F 76']

def b2h(b):
	return " ".join([hex(x)[2:].rjust(2, '0') for x in b]).upper()

def h2b(h):
	return bytes.fromhex(h)

def yield_info(filepath):
	if os.path.isdir(filepath):
		yield "directory"
	elif os.path.ismount(filepath):
		yield "Volume"
	elif os.path.isfile(filepath):
		f = open(filepath, 'br')
		f.seek(options.offset)
		data = f.read(options.bytes)
		f.close()
		
		matches = []
		for h in hexes:
			b = h2b(h)
			
			if len(b) < options.matchmin:
				continue
			if options.matchmax:
				b = b[:options.matchmax]
			try:
				i = data.index(b)
			except:
				continue
			else:
				result = "\x00DESC\x00 "
				result += "(%i)%s" % ((i + options.offset), " " if options.snippet else "\t")
				
				if options.snippet:
					start = max(0, i - options.snippet)
					end = i + len(b) + options.snippet
					
					_format = lambda x: b2h(x) if options.hex else str(x)[2:-1]
					if options.color:
						color_start = i
						color_end = i + len(b)
						
						snippet = _format(data[start:color_start])
						snippet += '%s\033[0;31m' % (" " if (snippet and options.hex) else "")
						snippet += _format(data[color_start:color_end])
						snippet += '\033[0m%s' % (" " if options.hex else "")
						snippet += _format(data[color_end:end])
						
					else:
						snippet = _format(data[start:end])
					
					result += "%s\t" % snippet
				
				for desc in sigs.get(h):
					matches.append((desc, result))
		if matches:
			desc_just = max([len(x[0]) for x in matches]) + 1
			for match in matches:
				desc = match[0] + ","
				desc = desc.ljust(desc_just)
				yield match[1].replace('\x00DESC\x00', desc, 1)
		else:
			if not list(filter(lambda x: x > 127, data)):
				yield "ASCII text"
			else:
				yield "data"

justification = max([len(x) for x in parser.largs]) + 2
for filepath in parser.largs:
	result = ("%s: " % filepath).ljust(justification)
	for information in yield_info(filepath):
		print(result + information)
